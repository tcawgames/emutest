<!DOCTYPE html>
<html>
<head>
    <title>EmulatorJS - Super Mario World</title>
    <link rel="icon" href="docs/favicon.ico" sizes="16x16 32x32 48x48 64x64" type="image/vnd.microsoft.icon">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden;
            background-color: black;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            font-family: monospace;
        }
        #display {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

    <!-- Optional top logo or header -->
    <div id="top" style="display:none;">
        <h1>EmulatorJS Demo</h1>
        <img src="docs/Logo-light.png" alt="Logo" style="width:130px;height:130px;">
    </div>

    <div id="display"></div>

    <script>
        // Configuration
        let enableDebug = false;
        let enableThreads = false;
        const defaultROM = "smw.sfc"; // Preset ROM filename

        // Check URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        if (parseInt(urlParams.get("debug")) === 1 || urlParams.get("debug") === "true") {
            enableDebug = true;
            console.log("Debug enabled");
        }
        if (parseInt(urlParams.get("threads")) === 1 || urlParams.get("threads") === "true") {
            if (window.SharedArrayBuffer) {
                enableThreads = true;
                console.log("Threads enabled");
            } else {
                console.warn("Threads unavailable. SharedArrayBuffer required.");
            }
        }
        const browserMode = urlParams.get("browserMode");

        // Function to start the emulator
        async function run(file) {
            const parts = file.split(".");
            const ext = parts.pop();

            // Determine core
            const core = (["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"].includes(ext)) ? "snes" :
                         (["nes","fds","unif","unf"].includes(ext)) ? "nes" :
                         ext; // default fallback

            const div = document.createElement("div");
            div.id = "display";
            document.body.appendChild(div);

            window.EJS_player = "#display";
            window.EJS_gameName = parts.join(".");
            window.EJS_biosUrl = "";
            window.EJS_gameUrl = `roms/${file}`;
            window.EJS_core = core;
            window.EJS_pathtodata = "data/";
            window.EJS_startOnLoaded = true;
            window.EJS_DEBUG_XX = enableDebug;
            window.EJS_disableDatabases = true;
            window.EJS_threads = enableThreads;
            if (browserMode) window.EJS_browserMode = browserMode;

            const script = document.createElement("script");
            script.src = "data/loader.js";
            document.body.appendChild(script);
        }

        // Auto-load default ROM
        if (urlParams.get("rom")) {
            run(urlParams.get("rom"));
        } else {
            run(defaultROM);
        }
    </script>

</body>
</html>
